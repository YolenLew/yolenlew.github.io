<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2021/06/14/logstash-bu-shu/"/>
      <url>/2021/06/14/logstash-bu-shu/</url>
      
        <content type="html"><![CDATA[<h3 id="Logstash部署"><a href="#Logstash部署" class="headerlink" title="Logstash部署"></a>Logstash部署</h3><h3 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h3><h4 id="1-1-拉取镜像"><a href="#1-1-拉取镜像" class="headerlink" title="1.1 拉取镜像"></a>1.1 拉取镜像</h4><pre class=" language-sh"><code class="language-sh">docker pull logstash:7.6.2</code></pre><h4 id="1-2-创建目录及文件"><a href="#1-2-创建目录及文件" class="headerlink" title="1.2 创建目录及文件"></a>1.2 创建目录及文件</h4><ul><li>创建目录及文件</li></ul><pre class=" language-sh"><code class="language-sh">mkdir -p /mydata/logstash/configmkdir -p /var/logstouch /mydata/logstash/config/logstash.conf</code></pre><ul><li>编辑配置文件<code>logstash.conf</code>，内容如下</li></ul><pre class=" language-ruby"><code class="language-ruby">input <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  file<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    path <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"/var/logs/**/*-debug.log"</span> <span class="token punctuation">]</span>    codec<span class="token operator">=</span><span class="token operator">></span>json    start_position <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"beginning"</span>    type <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"debug"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  file<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    path <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"/var/logs/**/*-error.log"</span> <span class="token punctuation">]</span>    codec<span class="token operator">=</span><span class="token operator">></span>json    start_position <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"beginning"</span>    type <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"error"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  file<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    path <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"/var/logs/**/*-record.log"</span> <span class="token punctuation">]</span>    codec<span class="token operator">=</span><span class="token operator">></span>json    start_position <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"beginning"</span>    type <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"record"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>filter <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  date<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    match <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"print_time"</span> <span class="token punctuation">,</span> <span class="token string">"ISO8601"</span> <span class="token punctuation">]</span>    target <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"@timestamp"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  mutate<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    remove_field <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"@version"</span><span class="token punctuation">,</span><span class="token string">"print_time"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">,</span><span class="token string">"host"</span><span class="token punctuation">,</span><span class="token string">"log"</span><span class="token punctuation">,</span><span class="token string">"prospector"</span><span class="token punctuation">,</span><span class="token string">"tags"</span><span class="token punctuation">]</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"record"</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>      json <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        source <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"message"</span>        remove_field <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span>      <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>output <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  elasticsearch <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    hosts <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"elasticsearch:9200"</span><span class="token punctuation">]</span>    index <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"kkb-%&amp;#123;type&amp;#125;-%&amp;#123;+YYYY.MM.dd&amp;#125;"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><h3 id="二、创建容器"><a href="#二、创建容器" class="headerlink" title="二、创建容器"></a>二、创建容器</h3><ul><li>创建指令</li></ul><pre class=" language-sh"><code class="language-sh">docker run -p 5045:5045 -p 9600:9600 --name logstash \  --link elasticsearch \  -e TZ="Asia/Shanghai" \  -v /mydata/logstash/config/logstash.conf:/usr/share/logstash/config/logstash.conf \  -v /var/logs:/var/logs \  -d logstash:7.6.2 -f /usr/share/logstash/config/logstash.conf</code></pre><ul><li>查看容器日志</li></ul><pre class=" language-sh"><code class="language-sh">docker logs -f -t --tail 10 logstash</code></pre><ul><li>如果日志没有报错，且显示成功运行如下，说明部署成功</li></ul><pre class=" language-verilog"><code class="language-verilog"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span>T19<span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">57.650367856</span>Z <span class="token punctuation">[</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">20</span>T01<span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">648</span><span class="token punctuation">]</span><span class="token punctuation">[</span>INFO <span class="token punctuation">]</span><span class="token punctuation">[</span>logstash<span class="token punctuation">.</span>agent           <span class="token punctuation">]</span> Successfully started Logstash API endpoint <span class="token operator">&amp;</span><span class="token number">#123</span><span class="token punctuation">;</span><span class="token punctuation">:</span>port<span class="token operator">=></span><span class="token number">9600</span><span class="token operator">&amp;</span><span class="token number">#125</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/06/14/elk-ri-zhi-shou-ji-xi-tong-da-jian/"/>
      <url>/2021/06/14/elk-ri-zhi-shou-ji-xi-tong-da-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="ELK日志收集系统"><a href="#ELK日志收集系统" class="headerlink" title="ELK日志收集系统"></a>ELK日志收集系统</h1><h2 id="1-系统架构"><a href="#1-系统架构" class="headerlink" title="1.系统架构"></a>1.系统架构</h2><p><img src="https://z3.ax1x.com/2021/05/14/gymqG8.png" alt="gymqG8.png"></p><h3 id="1-1-系统组成"><a href="#1-1-系统组成" class="headerlink" title="1.1 系统组成"></a>1.1 系统组成</h3><ol><li><strong>Logstash</strong>：一款轻量级的、开源的日志收集处理框架<ul><li>可以方便的把分散的、多样化的日志搜集起来</li><li>并进行自定义过滤分析处理</li><li>最后传输到指定的位置</li></ul></li><li><strong>Elasticsearch</strong>：实时的分布式搜索和分析引擎<ul><li>主要用于全文搜索，结构化搜索以及分析</li><li>实时搜索，实时分析</li><li>分布式架构、实时文件存储，并将每一个字段都编入索引</li><li>接口友好，支持JSON</li></ul></li><li><strong>Kibana</strong>：开源的数据分析可视化平台<ul><li>主要用于数据进行高效的搜索、可视化汇总和多维度分析</li><li>可以与Elasticsearch搜索引擎之中的数据进行交互</li><li>基于浏览器的界面操作可以快速创建动态仪表板</li><li>实时监控ElasticSearch的数据状态与更改</li></ul></li></ol><h3 id="1-2-流程说明"><a href="#1-2-流程说明" class="headerlink" title="1.2 流程说明"></a>1.2 流程说明</h3><ol><li>日志收集处理：Logstash部署在各个节点上搜集相关日志、数据，并经过分析、过滤后发送给远端服务器上的Elasticsearch进行存储</li><li>日志存储检索：Elasticsearch再将数据以分片的形式压缩存储，并提供多种API供用户查询、操作</li><li>日志可视化分析：通过Kibana Web直观的对日志进行查询，并根据需求生成数据报表</li></ol><p><img src="https://z3.ax1x.com/2021/05/14/gyuiTI.png" alt="gyuiTI.png"></p><h2 id="2-系统搭建"><a href="#2-系统搭建" class="headerlink" title="2.系统搭建"></a>2.系统搭建</h2><h3 id="2-1-参考资料"><a href="#2-1-参考资料" class="headerlink" title="2.1 参考资料"></a>2.1 参考资料</h3><ul><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1Nzg4NjgyMw==&mid=2247483823&idx=1&sn=842d342d688a4ebd14a2147dff1270d4&scene=21#wechat_redirect">《SpringBoot应用整合ELK实现日志收集》</a></p></li><li><p><a href="https://mp.weixin.qq.com/s/8nUunL02Y5AfXTCscYg54w">《你居然还去服务器上捞日志，搭个日志收集系统难道不香么！》</a></p></li><li><p><a href="https://juejin.cn/post/6844903641535479821">看完这个不会配置 logback ，请你吃瓜！</a></p></li></ul><h3 id="2-2-微服务集成Logstash"><a href="#2-2-微服务集成Logstash" class="headerlink" title="2.2 微服务集成Logstash"></a>2.2 微服务集成Logstash</h3><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><ul><li>pom.xml</li></ul><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 集成logstash --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>net.logstash.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>logstash-logback-encoder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h4 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h4><ul><li>application.yml</li></ul><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span>    <span class="token key atrule">root</span><span class="token punctuation">:</span> info    <span class="token key atrule">com.kkb</span><span class="token punctuation">:</span> debug  <span class="token key atrule">file</span><span class="token punctuation">:</span>    <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/logs</code></pre><h4 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h4><ul><li>logback-spring.xml</li></ul><blockquote><p>配置文件详解：</p><ul><li><a href="https://juejin.cn/post/6844903641535479821">看完这个不会配置 logback ，请你吃瓜！</a></li><li><a href="https://www.cnblogs.com/warking/p/5710303.html">logback的使用和logback.xml详解</a></li></ul></blockquote><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE configuration></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--引用默认日志配置--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org/springframework/boot/logging/logback/defaults.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--使用默认的控制台日志输出实现--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org/springframework/boot/logging/logback/console-appender.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--从spring中获取配置应用名称--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProperty</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>context<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>APP_NAME<span class="token punctuation">"</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spring.application.name<span class="token punctuation">"</span></span> <span class="token attr-name">defaultValue</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>springBoot<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--从spring中获取配置日志保存路径--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProperty</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>context<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LOG_FILE_PATH<span class="token punctuation">"</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logging.file.path<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--DEBUG日志输出到文件--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>FILE_DEBUG<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--输出DEBUG以上级别日志--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>DEBUG<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置为默认的文件日志格式--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>FILE_LOG_PATTERN<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置文件命名格式--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/debug/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-%d<span class="token entity" title="&#123;">&amp;#123;</span>yyyy-MM-dd<span class="token entity" title="&#125;">&amp;#125;</span>-%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置日志文件大小，超过就重新生成文件，默认10M--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_SIZE:-10MB<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--日志文件保留天数，默认30天--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_HISTORY:-30<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--ERROR日志输出到文件--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>FILE_ERROR<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--只输出ERROR级别的日志--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置为默认的文件日志格式--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>FILE_LOG_PATTERN<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置文件命名格式--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/error/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-%d<span class="token entity" title="&#123;">&amp;#123;</span>yyyy-MM-dd<span class="token entity" title="&#125;">&amp;#125;</span>-%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置日志文件大小，超过就重新生成文件，默认10M--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_SIZE:-10MB<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--日志文件保留天数，默认30天--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_HISTORY:-90<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- DEBUG日志格式化输出到ELK文件目录下--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LOG_STASH_DEBUG<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--输出级别的日志--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>DEBUG<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timestamp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeZone</span><span class="token punctuation">></span></span>Asia/Shanghai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeZone</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timestamp</span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--自定义日志输出格式--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>                        <span class="token entity" title="&#123;">&amp;#123;</span>                        "project": "kkb-project",                        "level": "%level",                        "print_time": "%date<span class="token entity" title="&#123;">&amp;#123;</span>\"yyyy-MM-dd'T'HH:mm:ss,SSSZ\"<span class="token entity" title="&#125;">&amp;#125;</span>",                        "service": "$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME:-<span class="token entity" title="&#125;">&amp;#125;</span>",                        "pid": "$<span class="token entity" title="&#123;">&amp;#123;</span>PID:-<span class="token entity" title="&#125;">&amp;#125;</span>",                        "thread": "%thread",                        "class": "%logger",                        "message": "%message",                        "stack_trace": "%exception<span class="token entity" title="&#123;">&amp;#123;</span>20<span class="token entity" title="&#125;">&amp;#125;</span>"                        <span class="token entity" title="&#125;">&amp;#125;</span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 正在记录的日志文件的路径及文件名 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/elklogs/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-debug.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置文件命名格式--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/elklogs/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-debug-%d<span class="token entity" title="&#123;">&amp;#123;</span>yyyy-MM-dd<span class="token entity" title="&#125;">&amp;#125;</span>-%i.log.gz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置日志文件大小，超过就重新生成文件，默认10M--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_SIZE:-10MB<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--日志文件保留天数，默认30天--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_HISTORY:-90<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- ERROR日志输出到ELK文件目录下--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LOG_STASH_ERROR<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--输出级别的日志--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timestamp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeZone</span><span class="token punctuation">></span></span>Asia/Shanghai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeZone</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timestamp</span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--自定义日志输出格式--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>                        <span class="token entity" title="&#123;">&amp;#123;</span>                        "project": "kkb-project",                        "level": "%level",                        "print_time": "%date<span class="token entity" title="&#123;">&amp;#123;</span>\"yyyy-MM-dd'T'HH:mm:ss,SSSZ\"<span class="token entity" title="&#125;">&amp;#125;</span>",                        "service": "$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME:-<span class="token entity" title="&#125;">&amp;#125;</span>",                        "pid": "$<span class="token entity" title="&#123;">&amp;#123;</span>PID:-<span class="token entity" title="&#125;">&amp;#125;</span>",                        "thread": "%thread",                        "class": "%logger",                        "message": "%message",                        "stack_trace": "%exception<span class="token entity" title="&#123;">&amp;#123;</span>20<span class="token entity" title="&#125;">&amp;#125;</span>"                        <span class="token entity" title="&#125;">&amp;#125;</span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 正在记录的日志文件的路径及文件名 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/elklogs/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置文件命名格式--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/elklogs/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-error-%d<span class="token entity" title="&#123;">&amp;#123;</span>yyyy-MM-dd<span class="token entity" title="&#125;">&amp;#125;</span>-%i.log.gz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置日志文件大小，超过就重新生成文件，默认10M--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_SIZE:-10MB<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--日志文件保留天数，默认30天--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_HISTORY:-90<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 接口访问日志输出到ELK文件目录下--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LOG_STASH_RECORD<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timestamp</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeZone</span><span class="token punctuation">></span></span>Asia/Shanghai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeZone</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timestamp</span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--自定义日志输出格式--></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>                        <span class="token entity" title="&#123;">&amp;#123;</span>                        "project": "kkb-project",                        "level": "%level",                        "print_time": "%date<span class="token entity" title="&#123;">&amp;#123;</span>\"yyyy-MM-dd'T'HH:mm:ss,SSSZ\"<span class="token entity" title="&#125;">&amp;#125;</span>",                        "service": "$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME:-<span class="token entity" title="&#125;">&amp;#125;</span>",                        "class": "%logger",                        "message": "%message"                        <span class="token entity" title="&#125;">&amp;#125;</span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- 正在记录的日志文件的路径及文件名 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/elklogs/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-record.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置文件命名格式--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_PATH<span class="token entity" title="&#125;">&amp;#125;</span>/elklogs/$<span class="token entity" title="&#123;">&amp;#123;</span>APP_NAME<span class="token entity" title="&#125;">&amp;#125;</span>-record-%d<span class="token entity" title="&#123;">&amp;#123;</span>yyyy-MM-dd<span class="token entity" title="&#125;">&amp;#125;</span>-%i.log.gz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--设置日志文件大小，超过就重新生成文件，默认10M--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_SIZE:-10MB<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--日志文件保留天数，默认30天--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>$<span class="token entity" title="&#123;">&amp;#123;</span>LOG_FILE_MAX_HISTORY:-90<span class="token entity" title="&#125;">&amp;#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--框架内部日志输出配置：未指定appender，则自动继承root节点中定义的appender--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.slf4j<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>springfox<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>io.swagger<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.hibernate.validator<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.alibaba.nacos.client.naming<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!--根日志记录器配置：logger输出日志配置--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DEBUG<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>FILE_DEBUG<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>FILE_ERROR<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LOG_STASH_DEBUG<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LOG_STASH_ERROR<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--接口访问日志记录器配置：--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.kkb.project.common.log.WebLogAspect<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DEBUG<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LOG_STASH_RECORD<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre><h3 id="2-3-ELK环境搭建"><a href="#2-3-ELK环境搭建" class="headerlink" title="2.3 ELK环境搭建"></a>2.3 ELK环境搭建</h3><h4 id="1-参考资料"><a href="#1-参考资料" class="headerlink" title="1.参考资料"></a>1.参考资料</h4><ul><li><p><a href="http://www.macrozheng.com/#/deploy/mall_deploy_docker?id=elasticsearch%e5%ae%89%e8%a3%85">基于Docker容器搭建ELK环境</a></p></li><li><p><a href="https://mp.weixin.qq.com/s/8nUunL02Y5AfXTCscYg54w">《你居然还去服务器上捞日志，搭个日志收集系统难道不香么！》</a></p></li></ul><h4 id="2-拉取镜像"><a href="#2-拉取镜像" class="headerlink" title="2.拉取镜像"></a>2.拉取镜像</h4><pre class=" language-dockerfile"><code class="language-dockerfile">docker pull elasticsearch:7.6.2docker pull kibana:7.6.2docker pull logstash:7.6.2</code></pre><h4 id="3-elasticsearch部署"><a href="#3-elasticsearch部署" class="headerlink" title="3.elasticsearch部署"></a>3.elasticsearch部署</h4><h5 id="创建容器"><a href="#创建容器" class="headerlink" title="创建容器"></a>创建容器</h5><pre class=" language-sh"><code class="language-sh">docker run -p 9200:9200 -p 9300:9300 --name elasticsearch \-e "discovery.type=single-node" \-e "cluster.name=elasticsearch" \-v /home/elasticsearch/plugins:/usr/share/elasticsearch/plugins \-v /home/elasticsearch/data:/usr/share/elasticsearch/data \-d elasticsearch:7.6.2</code></pre><h5 id="安装分词器IKAnalyzer"><a href="#安装分词器IKAnalyzer" class="headerlink" title="安装分词器IKAnalyzer"></a>安装分词器IKAnalyzer</h5><pre class=" language-sh"><code class="language-sh">docker exec -it elasticsearch /bin/bash# 此命令需要在容器中运行elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zipdocker restart elasticsearch</code></pre><h5 id="验证ElasticSearch"><a href="#验证ElasticSearch" class="headerlink" title="验证ElasticSearch"></a>验证ElasticSearch</h5><ul><li>Linux</li></ul><pre class=" language-sh"><code class="language-sh">curl -XGET localhost:9200</code></pre><ul><li>windows</li></ul><pre class=" language-http"><code class="language-http"># 浏览器访问<span class="token header-name keyword">http:</span>//192.168.211.110:9200</code></pre><ul><li>结果示例</li></ul><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"d72c19c6bf40"</span><span class="token punctuation">,</span>  <span class="token property">"cluster_name"</span> <span class="token operator">:</span> <span class="token string">"elasticsearch"</span><span class="token punctuation">,</span>  <span class="token property">"cluster_uuid"</span> <span class="token operator">:</span> <span class="token string">"0TuvBwtZSsWzfR-sMDzQKw"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span> <span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"number"</span> <span class="token operator">:</span> <span class="token string">"7.6.2"</span><span class="token punctuation">,</span>    <span class="token property">"build_flavor"</span> <span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>    <span class="token property">"build_type"</span> <span class="token operator">:</span> <span class="token string">"docker"</span><span class="token punctuation">,</span>    <span class="token property">"build_hash"</span> <span class="token operator">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span><span class="token punctuation">,</span>    <span class="token property">"build_date"</span> <span class="token operator">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span><span class="token punctuation">,</span>    <span class="token property">"build_snapshot"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"lucene_version"</span> <span class="token operator">:</span> <span class="token string">"8.4.0"</span><span class="token punctuation">,</span>    <span class="token property">"minimum_wire_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"6.8.0"</span><span class="token punctuation">,</span>    <span class="token property">"minimum_index_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"6.0.0-beta1"</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>  <span class="token property">"tagline"</span> <span class="token operator">:</span> <span class="token string">"You Know, for Search"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h4 id="4-kibana部署"><a href="#4-kibana部署" class="headerlink" title="4.kibana部署"></a>4.kibana部署</h4><h5 id="创建容器-1"><a href="#创建容器-1" class="headerlink" title="创建容器"></a>创建容器</h5><pre class=" language-sh"><code class="language-sh">docker run --name kibana -p 5601:5601 \--link elasticsearch \-e "elasticsearch.hosts=http://elasticsearch:9200" \-d kibana:7.6.2</code></pre><h4 id="5-logstash部署"><a href="#5-logstash部署" class="headerlink" title="5.logstash部署"></a>5.logstash部署</h4><h5 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1.环境准备"></a>1.环境准备</h5><ul><li>创建目录及文件</li></ul><pre class=" language-sh"><code class="language-sh">mkdir -p /mydata/logstash/config          touch /mydata/logstash/config/logstash.conf</code></pre><ul><li>配置<code>logstash.conf</code></li></ul><pre class=" language-ruby"><code class="language-ruby">input <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  file<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    path <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"/var/logs/**/*-debug.log"</span> <span class="token punctuation">]</span>    codec<span class="token operator">=</span><span class="token operator">></span>json    start_position <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"beginning"</span>    type <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"debug"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  file<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    path <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"/var/logs/**/*-error.log"</span> <span class="token punctuation">]</span>    codec<span class="token operator">=</span><span class="token operator">></span>json    start_position <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"beginning"</span>    type <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"error"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  file<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    path <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"/var/logs/**/*-record.log"</span> <span class="token punctuation">]</span>    codec<span class="token operator">=</span><span class="token operator">></span>json    start_position <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"beginning"</span>    type <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"record"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>filter <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  date<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    match <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token string">"print_time"</span> <span class="token punctuation">,</span> <span class="token string">"ISO8601"</span> <span class="token punctuation">]</span>    target <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"@timestamp"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  mutate<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    remove_field <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"@version"</span><span class="token punctuation">,</span><span class="token string">"print_time"</span><span class="token punctuation">,</span><span class="token string">"fields"</span><span class="token punctuation">,</span><span class="token string">"host"</span><span class="token punctuation">,</span><span class="token string">"log"</span><span class="token punctuation">,</span><span class="token string">"prospector"</span><span class="token punctuation">,</span><span class="token string">"tags"</span><span class="token punctuation">]</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"record"</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>      json <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        source <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"message"</span>        remove_field <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span>      <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>output <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>  elasticsearch <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    hosts <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">"elasticsearch:9200"</span><span class="token punctuation">]</span>    index <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"kkb-%&amp;#123;type&amp;#125;-%&amp;#123;+YYYY.MM.dd&amp;#125;"</span>  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><h5 id="2-创建容器"><a href="#2-创建容器" class="headerlink" title="2.创建容器"></a>2.创建容器</h5><pre class=" language-sh"><code class="language-sh">docker run -p 5045:5045 -p 9600:9600 --name logstash \  --link elasticsearch \  -e TZ="Asia/Shanghai" \  -v /mydata/logstash/config/logstash.conf:/usr/share/logstash/config/logstash.conf \  -v /var/logs:/var/logs \  -d logstash:7.6.2 -f /usr/share/logstash/config/logstash.conf</code></pre><h2 id="3-系统展示"><a href="#3-系统展示" class="headerlink" title="3.系统展示"></a>3.系统展示</h2><p><img src="https://z3.ax1x.com/2021/05/15/g6nl38.png" alt="g6nl38.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2021/06/14/hello-world/"/>
      <url>/2021/06/14/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
